<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>develop\core\element\container\Container.js - QTopo</title>
  
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="stylesheet" href="../assets/vendor/bootstrap/css/bootstrap.min.css">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
</head>
<body class="yui3-smart">
 <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
               <a class="navbar-brand mainlogo" href="https://github.com/hai3460377/QTopo">
             
            <img alt="QTopo" src="..\logo.png" title="QTopo">
            
                QTopo
          </a>
            </div>
            <div id="navbar" class="navbar-collapse collapse">
                 <ul class="nav navbar-nav">
                    
                    <li><a href="./download/qtopo.zip">下载</a>
                    </li>
                    
                </ul>
               <div class="navbar-form navbar-right filterAPi" autocomplete="off">
                <input type="text" id='txtSearchAPI' class="form-control search-query" placeholder="Search for API" />
                 <ul id="filterList" class="filterItems dropdown-menu" role="menu"></ul>
                </div>
            </div>
        </div>
    </nav>
    <div id="sidebar">
    <h3>Modules/Classes</h3>
        <div id="api-tabview-filter">
            <input id='txtSearch' type="search" class="form-control" placeholder="Type to filter Modules/Classes">
        </div>
        <dl id="sidebar_list">
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/component.html">component</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/rightMenu.html">rightMenu</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/core.html">core</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/[C] Container.html">[C] Container</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Group.html">Group</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/DirectLine.html">DirectLine</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/[LE] Line.html">[LE] Line</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/CurveLink.html">CurveLink</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/DirectLink.html">DirectLink</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/FlexionalLink.html">FlexionalLink</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/FoldLink.html">FoldLink</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/[L] Link.html">[L] Link</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/ImageNode.html">ImageNode</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/[N] Node.html">[N] Node</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/TextNode.html">TextNode</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/[E] Element.html">[E] Element</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/Scene.html">Scene</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
                <dt>
                    <span class="glyphicon glyphicon-minus"></span>
                    <a href="../modules/QTopo.html">QTopo</a>
                </dt>
                <dd>
                    <ul>
                   
                       <li>
                            
                           <a href="../classes/QTopo.html">QTopo</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/QTopo.instance.html">QTopo.instance</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                       <li>
                            
                           <a href="../classes/QTopo.util.html">QTopo.util</a>
                           <ul>
                                
                           </ul>
                       </li>
                    
                    </ul>
                </dd>
             
        </dl>
</div>
   
    <div class="stdoc-content">
        <!--     <form id="options-form" class="form-inline pull-right">
        Show:
        <label for="api-show-inherited" class="checkbox">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected" class="checkbox">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private" class="checkbox">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated" class="checkbox">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </form>

 -->
        <div class="apidocs">
            <div id="docs-main">
                <div class="content">
                    <div class="page-header">
    <h1>develop\core\element\container\Container.js <small>File</small></h1>
</div>

<div class="file">
    <pre class="prettyprint linenums" id='src_code'>
/**
 * @module core
 */
/**
 * 容器基类,用以继承 [E]开头继承于Element,[C]开头为自身api
 * @class [C] Container
 * @constructor
 * @extends [E] Element
 * @param jtopo 元素核心的jtopo对象
 */

var Element = require(&quot;../Element.js&quot;);
module.exports = Container;
var jtopoReset = {
    //重写名称绘制，用以换行显示
    paintText: function (a) {
        var text = this.text;
        if (null != text &amp;&amp; &quot;&quot; != text) {
            a.beginPath();
            a.font = this.font;
            var fontWidth = a.measureText(&quot;田&quot;).width;
            var maxWidth = fontWidth;
            a.fillStyle = &quot;rgba(&quot; + this.fontColor + &quot;,1)&quot;; //&quot;, &quot; + this.alpha + &quot;)&quot;;名称永远不透明
            //换行检测
            var texts = text.split(&quot;\n&quot;);
            for (var i = 0; i &lt; texts.length; i++) {
                var width = a.measureText(texts[i]).width;
                if (width &gt; maxWidth) {
                    maxWidth = width;
                }
            }
            var e = this.getTextPostion(this.textPosition, maxWidth, fontWidth,texts.length);
            for (var j = 0; j &lt; texts.length; j++) {
                var textWidth = a.measureText(texts[j]).width;
                a.fillText(texts[j], e.x + (maxWidth - textWidth) / 2, e.y + j * fontWidth);
            }

            a.closePath();
        }
    }
};
function Container(jtopo) {
    if (jtopo) {
        Element.call(this, jtopo);
    } else {
        QTopo.util.error(&quot;create Container without jtopo&quot;, this);
    }
    /**
     * 记录容器内的元素
     * @property [C] children {array}
     */
    this.children = [];
    /**
     * 记录容器上的链路
     * @property [C] links {array}
     * @param in 以容器为终点的链路
     * @param out 以容器为起点的链路
     */
    this.links = {
        in: [],
        out: []
    };
    reset(this);
}
QTopo.util.inherits(Container, Element);
function reset(element) {
    element.jtopo.paintText = jtopoReset.paintText;
}
/**
 *  设置容器名称
 *  @method [C] setName
 *  @param name {string}
 */
Container.prototype.setName = function (name) {
    if (name) {
        if (this.attr.namePosition != &quot;hide&quot;) {
            this.jtopo.text = name.trim();
        }
        this.attr.name = name.trim();
    }
};
/**
 *  将元素加入容器内
 *  @method [C] add
 *  @param element {element|array} 一般为节点类型对象或数组，容器加入容器容易产生Bug
 */
Container.prototype.add = function (element) {
    var self=this;
    if (!$.isArray(this.children)) {
        this.children = [];
    }
    if ($.isArray(element)) {
        $.each(element,function(i,el){
            addOnce(el);
        });
    }else{
        addOnce(element);
    }
    function addOnce(element){
        if (element&amp;&amp;check(element)&amp;&amp;!self.isChild(element)) {
            self.children.push(element);
            element.parent = self;
            self.jtopo.add(element.jtopo);
            if (self.attr.children &amp;&amp; typeof self.attr.children.dragble == &quot;boolean&quot;) {
                //若分组不允许移动组内元素，手动设置元素不可移动
                element.setDragable(self.attr.children.dragble);
            }
        }
    }
    function check(element){
        return element.getType()==QTopo.constant.NODE&amp;&amp;element.getUseType()!=QTopo.constant.CASUAL&amp;&amp;!element.parent;
    }
};
/**
 * 将子元素从容器中删除
 * @method [C] remove
 * @param element {element}
 */
Container.prototype.remove = function (element) {
    if ($.isArray(this.children) &amp;&amp; this.isChild(element)) {
        this.children.splice(this.children.indexOf(element), 1);
        delete element.parent;
        this.jtopo.remove(element.jtopo);
        //移除元素，应手动设回元素可移动
        element.setDragable(true);
    }
};
/**
 * 获取容器基本类型
 * @method [C] getType
 * @return QTopo.constant.CONTAINER
 */
Container.prototype.getType = function () {
    return QTopo.constant.CONTAINER;
};
/**
 * 设置容器背景色
 * @method [C] setColor
 * @param color {string} &quot;255,255,255&quot;/&quot;#ffffff&quot;
 */
Container.prototype.setColor = function (color) {
    if (color) {
        color = QTopo.util.transHex(color.toLowerCase());
        this.jtopo.fillColor = color;
    }
    this.attr.color = this.jtopo.fillColor;
};
/**
 * 设置容器内子元素一般行为,未完全实现
 * @method [C] setChildren
 * @param children {object}
 *          children={
 *                  dragble:是否可移动{boolean}
 *          }
 */
Container.prototype.setChildren = function (children) {
    var jtopo = this.jtopo;
    if (children) {
        if (typeof children.dragble == &quot;boolean&quot;) {
            this.jtopo.childDragble = children.dragble;
            for (var i = 0; i &lt; this.children.length; i++) {
                this.children[i].setDragable(children.dragble);
            }
        }
    }
    this.attr.children.dragble = jtopo.childDragble;
};
/**
 * 容器缩放切换,在scene创建时可选是否提供切换
 *
 * 可在创建时增加参数 toggle:{close:true}来创建一个不可切换的容器
 *
 * 若无切换对象，则该方法无动作
 * @method [C] toggle
 * @param [flag] 为true则强制缩放，为false则强制展开，无值则自适应切换,
 */
Container.prototype.toggle = function (flag) {
    if (this.toggleTo) {
        var gJtopo = this.jtopo;
        var nJtopo = this.toggleTo.jtopo;
        var todo = typeof flag == &quot;boolean&quot; ? flag : gJtopo.visible;
        if (todo) {
            //缩放
            this.hide();
            this.toggleTo.show();
            this.toggleTo.setPosition([gJtopo.cx - nJtopo.width / 2, gJtopo.cy - nJtopo.height / 2]);
        } else {
            //展开
            this.show();
            this.toggleTo.hide();
            this.setPosition([nJtopo.cx - gJtopo.width / 2, nJtopo.cy - gJtopo.height / 2]);
        }
    }
};
/**
 * 判断元素是否已是子元素
 * @method [C] isChild
 * @param element 判断的子元素
 * @return {boolean}
 */
Container.prototype.isChild = function (element) {
    if ($.isArray(this.children)) {
        var index=this.children.indexOf(element);
        if (element.parent != this&amp;&amp; index&gt; -1) {
            QTopo.util.error(&quot;some group get error,the child&#x27;s parent is not it and the child in its children,index is &quot;+index, this,element);
        }
        return index&gt;-1;
    } else {
        return false;
    }
};
/**
 * 判断元素是否在分组覆盖的范围内,临时元素不考虑
 * @method [C] isInside
 * @param element 判断的元素
 * @return {boolean}
 */
Container.prototype.isInside = function (element) {
    if (element &amp;&amp; element.getType() != QTopo.constant.CASUAL) {
        var center = element.getCenterPosition();
        return !this.isChild(element) &amp;&amp; center.x &gt; this.x &amp;&amp; center.x &lt; (this.x + this.width) &amp;&amp; center.y &gt; this.y &amp;&amp; center.y &lt; (this.y + this.height);
    } else {
        return false;
    }
};
/**
 * 分组属性提取
 * @method [C] toJson
 * @return {object}
 */
Container.prototype.toJson=function(){
    var json=$.extend({},this.attr);
    json.extra=$.extend({},this.extra);
    json.children=[];
    this.children.map(function(child){
        json.children.push(child.get(&#x27;jsonId&#x27;));
    });
    json.toggle=this.toggleTo.toJson();
    return json;
};
    </pre>
</div>

                </div>
            </div>
        </div>
    </div>
<a id="gotoTop" class='well well-small' href='#'>
    Top
</a>
<script src="../assets/vendor/jquery/jquery-1.8.2.min.js"></script>
<script src="../assets/vendor/bootstrap/js/bootstrap.min.js"></script>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script src="../assets/js/config.js"></script>
<script src="../assets/js/doc.js"></script>
</body>
</html>
